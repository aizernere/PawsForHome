{% extends "index.html" %}

{% block contents %}
<script src="https://cdn.tailwindcss.com"></script>
{% load static %}
<link rel="stylesheet" href="{% static 'css/landing_page.css' %}">

<div class="flex h-[calc(100vh-110px)] overflow-hidden">
    <!-- Conversations List -->
    <div class="md:w-1/3 w-full p-4 overflow-y-auto h-full">
        <h2 class="text-lg font-bold mb-4">Conversations</h2>
        <ul class="space-y-2">
            {% for partner in conversation_partners %}
            <li onclick="window.location.href='{% url 'view_conversation' partner.id %}'" class="cursor-pointer bg-[#F2968F] p-4 rounded-full shadow-md flex items-center">
                <h3 class="text-md text-white font-semibold">{{ partner.first_name }} {{ partner.last_name }}</h3>
            </li>
            {% empty %}
            <li class="text-center text-gray-500">No conversations found.</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Messages Section -->
    <div class="md:w-2/3 w-full flex flex-col h-full rounded-lg overflow-hidden">
        {% if receiver %}
        <header class="bg-[#F2968F] text-white p-4 rounded-t-lg">
            <h2 class="text-lg font-semibold">{{ receiver.first_name }} {{ receiver.last_name }}</h2>
        </header>
        
        <!-- Message List -->
        <div id="messageContainer" class="flex-grow p-4 space-y-4 overflow-y-auto bg-gray-100">
            {% for message in messages %}
                {% if message.sender == request.user %}
                    <div class="flex justify-end">
                        <small class="text-gray-500 ml-2">{{ message.timestamp|date:"M d, Y H:i" }}</small>
                        <div class="bg-gray-300 p-2 rounded-lg text-black max-w-xs">{{ message.content }}</div>
                    </div>
                {% else %}
                    <div class="flex">
                        <div class="bg-[#F2968F] p-2 rounded-lg text-white max-w-xs">{{ message.content }}</div>
                        <small class="text-gray-500 ml-2">{{ message.timestamp|date:"M d, Y H:i" }}</small>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- Message Input -->
        <form method="POST" class="bg-white p-4 border-t border-gray-200 flex items-center space-x-2 rounded-b-lg">
            {% csrf_token %}
            <input type="text" name="content" placeholder="Type message..." required class="flex-grow p-2 border rounded-full border-gray-300 focus:outline-none">
            <button type="submit" class="bg-[#F2968F] hover:bg-red-400 text-white font-semibold px-4 rounded-full">Send</button>
        </form>
        {% else %}
        <p class="text-center text-gray-500 p-4 rounded-lg">Select a conversation to start chatting.</p>
        {% endif %}
    </div>

</div>

<script>
    // Scroll to the bottom of the message container when the page loads
    document.addEventListener("DOMContentLoaded", function() {
        const messageContainer = document.getElementById("messageContainer");
        messageContainer.scrollTop = messageContainer.scrollHeight;
    });
</script>

{% endblock contents %}
